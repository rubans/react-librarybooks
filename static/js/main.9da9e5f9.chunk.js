(window["webpackJsonpreact-hooks"]=window["webpackJsonpreact-hooks"]||[]).push([[0],{47:function(e,t,n){e.exports=n(78)},53:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);n(48);var r=n(0),a=n.n(r),o=n(25),c=n.n(o),l=(n(53),n(5)),i=n.n(l),s=n(12),u=n(7),m=n(16);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var f=function(e){var t=e.currentUser,n=Object(r.useState)(t),o=Object(u.a)(n,2),c=o[0],l=o[1];console.log("props:"+JSON.stringify(e)),console.log("editing:"+e.editing);var i=function(e){var t=e.target,n=t.name,r=t.value;l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},c,Object(m.a)({},n,r)))};return a.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.updateUser(c.id,c),"undefined"!==typeof e.setViewMode&&e.setViewMode("viewUser")}},a.a.createElement("label",null,"Name"),a.a.createElement("input",{type:"text",name:"name",value:c.name,onChange:i}),a.a.createElement("label",null,"Email"),a.a.createElement("input",{type:"text",name:"username",value:c.username,onChange:i}),a.a.createElement("label",null,"Password"),a.a.createElement("input",{type:"text",name:"password",value:c.password,onChange:i}),a.a.createElement("button",{className:"btn btn-primary"},"Save"),a.a.createElement("button",{onClick:function(){return e.setViewMode("viewUser")},className:"btn btn-danger"},"Cancel"))},p=function(e){return a.a.createElement("table",null,a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Username"))),a.a.createElement("tbody",null,e.users.length>0?e.users.map((function(e){return a.a.createElement("tr",{key:e.id},a.a.createElement("td",null,e.username))})):a.a.createElement("tr",null,a.a.createElement("td",{colSpan:3},"No users"))))};function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=n(55);n(65);E.initializeApp({apiKey:"AIzaSyDh0dHvfYVmQobx7VyKNCD2WZ2UFAY6wMA",projectId:"fast-planet-243821",appId:"1:515007598211:web:d7f919e31f73d3463f15b6"}),console.log("Firebase initialized!");var h=function(){var e=Object(s.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!1,e.next=3,E.auth().signInWithEmailAndPassword(t,n).then((function(e){r=!0})).catch((function(e){console.error("Unauthorized with Firebase : "+e)}));case 3:return console.log("Authorized with Firebase!"+r),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("createBook!"),console.log("firebase:"+JSON.stringify(E.auth())),n=E.firestore(),null!==t.id){e.next=8;break}return e.next=6,n.collection("Library_Books").add(t).then((function(e){console.log("Document written with ID: ",e.id)})).catch((function(e){console.error("Error adding document: ",e),alert(e)}));case 6:e.next=10;break;case 8:return e.next=10,n.collection("Library_Books").doc(t.id).update(t).then((function(e){console.log("Document written with ID: ",t.id)})).catch((function(e){console.error("Error adding document: ",e),alert(e)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteBook!"),n=E.firestore(),e.next=4,n.collection("Library_Books").doc(t).delete().then((function(e){console.log("Document deleted with ID: ",t)})).catch((function(e){console.error("Error deleting document: ",e),alert(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(s.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getBooks!"),t=[],n=E.firestore(),e.next=5,n.collection("Library_Books").get().then((function(e){t=e.docs.map((function(e){return b({},e.data(),{id:e.id})})),console.log("books:"+JSON.stringify(t))})).catch((function(e){console.error("Error getting document: ",e),alert(e)}));case 5:return console.log("All documents retrieved!"),console.log("books : "+JSON.stringify(t)),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=Object(s.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],console.log("getUsersInDB"),r=E.firestore(),e.next=5,r.collection("Library_Users").get().then((function(e){return n=e.docs.map((function(e){return b({},e.data(),{id:e.id})}))})).catch((function(e){console.error("Error getting document: ",e),alert(e)}));case 5:return console.log("users : "+JSON.stringify(n)),console.log("All documents retrieved!"),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j={id:null,name:"",username:"",password:""},k=function(e){var t=Object(r.useState)([]),n=Object(u.a)(t,2),o=n[0],c=n[1];Object(r.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:t=e.sent,console.log("load data:"+JSON.stringify(t)),c(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var l=Object(r.useState)(j),m=Object(u.a)(l,2),d=m[0],g=m[1],b=Object(r.useState)("view"),E=Object(u.a)(b,2),h=E[0],y=E[1],v=function(e,t){c(o.map((function(n){return n.id===e?t:n})))};return a.a.createElement("div",{className:"flex-row"},a.a.createElement("div",{className:"flex-large"},"edit"===h?a.a.createElement(r.Fragment,null,a.a.createElement("h3",null,"Edit user"),a.a.createElement(f,{editing:!0,setViewMode:y,currentUser:d,updateUser:v})):"new"===h?a.a.createElement(r.Fragment,null,a.a.createElement("h3",null,"Register"),a.a.createElement(f,{editing:!1,setViewMode:y,currentUser:j,updateUser:v})):a.a.createElement(r.Fragment,null,a.a.createElement("div",{className:"centered"},a.a.createElement("h3",null,"Users")),a.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}}),a.a.createElement(p,{users:o,editRow:function(e){y("edit"),g({id:e.id,name:e.name,username:e.username})},deleteUser:function(e){c(o.filter((function(t){return t.id!==e})))}}))))};function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var N=function(e){var t=e.currentBook,n=Object(r.useState)(t),o=Object(u.a)(n,2),c=o[0],l=o[1],d=Object(r.useState)([]),f=Object(u.a)(d,2),p=f[0],g=f[1];Object(r.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:t=e.sent,console.log("load book form user:"+JSON.stringify(t)),g(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var b=function(e){var t=e.target,n=t.name,r=t.value;l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},c,Object(m.a)({},n,r)))};return a.a.createElement("div",{className:"container"},a.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.updateBook(c.id,c),e.setViewMode("viewBook")}},a.a.createElement("label",null,"Name"),a.a.createElement("input",{type:"text",name:"name",value:c.name,onChange:b}),a.a.createElement("label",null,"Owner Email"),a.a.createElement("select",{onChange:b,name:"ownerEmail"},p.map((function(e){return a.a.createElement("option",{value:e.username},e.username)}))),a.a.createElement("div",{className:"centered"},a.a.createElement("button",{className:"btn btn-primary"},"Save"),a.a.createElement("button",{onClick:function(){return e.setViewMode("viewBook")},className:"btn btn-danger"},"Cancel"))))},x=function(e){return a.a.createElement("table",{class:"table table-bordered"},a.a.createElement("thead",null,a.a.createElement("tr",{className:"table-primary"},a.a.createElement("th",null,"Book"),a.a.createElement("th",null))),a.a.createElement("tbody",null,e.books.length>0?e.books.map((function(t){return a.a.createElement("tr",{key:t.id},a.a.createElement("td",null,t.name),a.a.createElement("td",null,a.a.createElement("div",{style:e.isAdmin?{display:"flex",justifyContent:"flex-end"}:{display:"none"}},a.a.createElement("button",{onClick:function(){e.editRow(t)},className:"btn btn-primary"},"Edit"),a.a.createElement("button",{onClick:function(){return e.deleteBook(t.id)},className:"btn btn-danger"},"Delete")),a.a.createElement("div",{style:e.isLoggedIn&&!e.isAdmin?{display:"flex",justifyContent:"flex-end"}:{display:"none"}},a.a.createElement("a",{href:"mailto:".concat(t.ownerEmail,"\n                  ?subject=Book Library Borrow Request - ").concat(t.name,"\n                  &body=Dear Sir/Madam,").concat(escape("\r\n")," I'm interested in borrowing ").concat(t.name,".").concat(escape("\r\n"),"Could you send me more information please?"),className:"button muted-button"},"Borrow"))))})):a.a.createElement("tr",null,a.a.createElement("td",{colSpan:3},"No books"))))},P=Object(r.createContext)({}),L=function(){return Object(r.useContext)(P)},B=function(){sessionStorage.isSessionLoggedIn=!1,E.auth().signOut().then((function(){})).catch((function(e){console.log("Error with Firebase : "+e),alert(e)}))},C=function(e){var t=e.children,n=Object(r.useState)({loading:!0,data:null,isAdmin:!1,isLoggedIn:!1,isSessionLoggedIn:!1}),o=Object(u.a)(n,2),c=o[0],l=o[1],i=function(e){console.log("setAuthData:"+JSON.stringify(e)),sessionStorage.isSessionLoggedIn,sessionStorage.isSessionLoggedIn=!0,console.log("set Session:"+sessionStorage.isSessionLoggedIn),l({data:e,isAdmin:e&&"admin@booklibrary.com"===e.email,isLoggedIn:null!==e,isSessionLoggedin:sessionStorage.isSessionLoggedIn===String(!0)})};return Object(r.useEffect)((function(){var e=E.auth().onAuthStateChanged((function(e){i(e||null)}));return function(){return e()}}),[]),a.a.createElement(P.Provider,{value:{auth:c,setAuthData:i}},t)},D=function(e){var t=L().auth;console.log("admin:"+JSON.stringify(t)),console.log("book:"+JSON.stringify(e));var n=Object(r.useState)([]),o=Object(u.a)(n,2),c=o[0],l=o[1];Object(r.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:t=e.sent,console.log("load data:"+JSON.stringify(t)),l(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),console.log("loaded books:"+JSON.stringify(c));console.log("set books:"+JSON.stringify(c));var m=Object(r.useState)({id:null,name:"",ownerEmail:""}),d=Object(u.a)(m,2),f=d[0],p=d[1],g=Object(r.useState)("view"),b=Object(u.a)(g,2),E=b[0],h=b[1],w=function(e,t){y(t),l(c.map((function(n){return n.id===e?t:n}))),console.log("update book"+JSON.stringify(c))};return a.a.createElement("div",{className:"container flex-row"},a.a.createElement("div",{className:"flex-large"},"edit"===E?a.a.createElement(r.Fragment,null,a.a.createElement("div",{className:"centered"},a.a.createElement("h3",null,"Edit Book")),a.a.createElement(N,{editing:!0,setViewMode:h,currentBook:f,updateBook:w})):"new"===E?a.a.createElement(r.Fragment,null,a.a.createElement("div",{className:"centered"},a.a.createElement("h3",null,"Create Book")),a.a.createElement(N,{editing:!1,setViewMode:h,currentBook:f,updateBook:w})):a.a.createElement(r.Fragment,null,a.a.createElement("div",{className:"centered"},a.a.createElement("h3",null,"Books")),a.a.createElement("div",{style:t.isAdmin?{display:"flex",justifyContent:"flex-end",margin:"10px"}:{display:"none"}},a.a.createElement("button",{onClick:function(){h("new")},className:"btn btn-primary"},"Add New Book")),a.a.createElement(x,{books:c,editRow:function(e){h("edit"),p({id:e.id,name:e.name,ownerEmail:e.ownerEmail})},deleteBook:function(e){v(e),l(c.filter((function(t){return t.id!==e})))},isAdmin:t.isAdmin,isLoggedIn:t.isLoggedIn}))))},A=n(22),I=function(e){var t=Object(r.useState)(""),n=Object(u.a)(t,2),o=n[0],c=n[1],l=Object(r.useState)(""),i=Object(u.a)(l,2),s=i[0],m=i[1];return a.a.createElement("div",{className:"container col-lg-3 center-block"},a.a.createElement("h3",null,"Login In"),a.a.createElement("form",{autoComplete:"off",onSubmit:function(t){t.preventDefault(),console.log("history:"+JSON.stringify(e)),h(o,s).then((function(t){if(console.log("login successful!"+t),!t)throw new Error;var n=e.location.state?e.location.state.from.pathname:"";console.log("redirect to :"+JSON.stringify(n)),e.history.push(n)})).catch((function(e){console.error("login unsuccessful!"+e),alert("wrong email or password combination")}))}},a.a.createElement("div",{className:"form-group"},a.a.createElement("input",{type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter email",value:o,onChange:function(e){c(e.target.value)}})),a.a.createElement("div",{className:"form-group"},a.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control",id:"exampleInputPassword1",placeholder:"Password",value:s,onChange:function(e){m(e.target.value)}})),a.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit"),a.a.createElement(A.b,{to:"/register",className:"btn btn-link"},"Register")))},U=n(43),J=n(17),M=function(e){var t=e.component,n=Object(U.a)(e,["component"]),r=L().auth;return console.log("Private Route, Logged User:"+JSON.stringify(r.isSessionLoggedin)),r.loading?a.a.createElement(J.b,Object.assign({},n,{render:function(){return a.a.createElement("p",null,"Loading...")}})):a.a.createElement(J.b,Object.assign({},n,{render:function(e){return r.isSessionLoggedin?a.a.createElement(t,e):a.a.createElement(J.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},V=function(e){return a.a.createElement("div",null,a.a.createElement("h3",null,"Register"),a.a.createElement(f,{editing:!0,setViewMode:k.setViewMode,currentUser:j,updateUser:function(t,n){console.log("new user:"+JSON.stringify(n)),function(e,t){var n=E.firestore();E.auth().createUserWithEmailAndPassword(e,t).then((function(){n.collection("Library_Users").add({username:e})})).then((function(){console.log("created user.")})).catch((function(e){console.error("Error creating user: ",e),alert(e)}))}(n.username,n.password),function(e){var t=e.match.path;console.log("current href :"+t);var n={pathname:"/login",state:{from:{pathname:t}}};e.history.push(n)}(e)}}))},F=n(82),R=n(81),_=function(e){var t=L().auth.data;console.log("Nav Bar User:"+JSON.stringify(t));var n=L().auth.isAdmin,r=t?t.email:"";return a.a.createElement(F.a,{bg:"primary",variant:"dark"},a.a.createElement(R.a,{className:"mr-auto"},a.a.createElement(R.a.Link,{href:"/"},"Home"),n?a.a.createElement(R.a.Link,{href:"/users"},"Users"):"",a.a.createElement(R.a.Link,{href:"/books"},"Books")),a.a.createElement(F.a.Collapse,{className:"justify-content-end"},""!==r?a.a.createElement("div",null,a.a.createElement(F.a.Text,null,"Signed in as : ",a.a.createElement("a",{href:"#login"},r)),a.a.createElement("button",{onClick:function(){B()},className:"bg-light btn my-2 my-sm-0",style:{marginLeft:"10px"}},"Signout")):a.a.createElement("a",{href:"/Login",className:"bg-light btn my-2 my-sm-0"},"Login")))},z=function(){return a.a.createElement("div",{className:"container"},a.a.createElement("h2",null,"Home page"),a.a.createElement("blockquote",null,"Welcome to the Book Library!"))},H=function(e){var t=L().authUser;return console.log("Rendering App..."),console.log("App Props:"+JSON.stringify(e)),console.log("App auth User:"+JSON.stringify(t)),a.a.createElement(C,null,a.a.createElement(A.a,null,a.a.createElement("div",{className:"App"},a.a.createElement(_,null)),a.a.createElement("br",null),a.a.createElement(J.b,{path:"/",exact:!0,component:z}),a.a.createElement(J.b,{path:"/login",exact:!0,component:I}),a.a.createElement(M,{path:"/users",component:k}),a.a.createElement(J.b,{path:"/books",render:function(e){return a.a.createElement(D,e)}}),a.a.createElement(J.b,{path:"/register",exact:!0,component:V})))},W=document.getElementById("root");c.a.render(a.a.createElement(H,null),W)}},[[47,1,2]]]);
//# sourceMappingURL=main.9da9e5f9.chunk.js.map