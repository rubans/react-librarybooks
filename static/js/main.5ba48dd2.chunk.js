(window["webpackJsonplibrary-books"]=window["webpackJsonplibrary-books"]||[]).push([[0],{65:function(e,t,n){e.exports=n(96)},71:function(e,t,n){},96:function(e,t,n){"use strict";n.r(t);n(66);var a=n(0),r=n.n(a),o=n(32),c=n.n(o),l=(n(71),n(6)),i=n.n(l),s=n(17),u=n(8),m=n(15);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var f=function(e){var t=e.currentUser,n=Object(a.useState)(t),o=Object(u.a)(n,2),c=o[0],l=o[1];console.log("props:"+JSON.stringify(e)),console.log("editing:"+e.editing);var i=function(e){var t=e.target,n=t.name,a=t.value;l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},c,Object(m.a)({},n,a)))};return r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.updateUser(c.id,c),"undefined"!==typeof e.setViewMode&&e.setViewMode("viewUser")}},r.a.createElement("label",null,"Name"),r.a.createElement("input",{type:"text",name:"name",value:c.name,onChange:i}),r.a.createElement("label",null,"Email"),r.a.createElement("input",{type:"text",name:"username",value:c.username,onChange:i}),r.a.createElement("label",null,"Password"),r.a.createElement("input",{type:"text",name:"password",value:c.password,onChange:i}),r.a.createElement("button",{className:"btn btn-primary"},"Save"),r.a.createElement("button",{onClick:function(){return e.setViewMode("viewUser")},className:"btn btn-danger"},"Cancel"))},p=n(107),b=n(14),g=n(111),E=n(114),h=n(117),y=n(109),v=n(112),O=n(113),w=n(110),j=Object(p.a)({table:{minWidth:650}}),k=Object(b.a)((function(e){return{head:{backgroundColor:e.palette.common.black,color:e.palette.common.white},body:{fontSize:14}}}))(h.a),S=function(e){var t=j();return r.a.createElement(y.a,{component:w.a},r.a.createElement(g.a,{className:t.table,size:"small","aria-label":"a dense table"},r.a.createElement(v.a,null,r.a.createElement(O.a,null,r.a.createElement(k,null,"Username"))),r.a.createElement(E.a,null,e.users.length>0?e.users.map((function(e){return r.a.createElement(O.a,{key:e.id},r.a.createElement(h.a,{component:"th",scope:"row"},e.username))})):r.a.createElement(O.a,null,r.a.createElement(h.a,{colSpan:3},"No users")))))};function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=n(76);n(86);P.initializeApp({apiKey:"AIzaSyDh0dHvfYVmQobx7VyKNCD2WZ2UFAY6wMA",projectId:"fast-planet-243821",appId:"1:515007598211:web:d7f919e31f73d3463f15b6"}),console.log("Firebase initialized!");var B=function(){var e=Object(s.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!1,e.next=3,P.auth().signInWithEmailAndPassword(t,n).then((function(e){a=!0})).catch((function(e){console.error("Unauthorized with Firebase : "+e)}));case 3:return console.log("Authorized with Firebase!"+a),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),C=function(){var e=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("createBook!"),console.log("firebase:"+JSON.stringify(P.auth())),n=P.firestore(),null!==t.id){e.next=8;break}return e.next=6,n.collection("Library_Books").add(t).then((function(e){console.log("Document written with ID: ",e.id)})).catch((function(e){console.error("Error adding document: ",e),alert(e)}));case 6:e.next=10;break;case 8:return e.next=10,n.collection("Library_Books").doc(t.id).update(t).then((function(e){console.log("Document written with ID: ",t.id)})).catch((function(e){console.error("Error adding document: ",e),alert(e)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteBook!"),n=P.firestore(),e.next=4,n.collection("Library_Books").doc(t).delete().then((function(e){console.log("Document deleted with ID: ",t)})).catch((function(e){console.error("Error deleting document: ",e),alert(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(s.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getBooks!"),t=[],n=P.firestore(),e.next=5,n.collection("Library_Books").get().then((function(e){t=e.docs.map((function(e){return x({},e.data(),{id:e.id})})),console.log("books:"+JSON.stringify(t))})).catch((function(e){console.error("Error getting document: ",e),alert(e)}));case 5:return console.log("All documents retrieved!"),console.log("books : "+JSON.stringify(t)),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(s.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],console.log("getUsersInDB"),a=P.firestore(),e.next=5,a.collection("Library_Users").get().then((function(e){return n=e.docs.map((function(e){return x({},e.data(),{id:e.id})}))})).catch((function(e){console.error("Error getting document: ",e),alert(e)}));case 5:return console.log("users : "+JSON.stringify(n)),console.log("All documents retrieved!"),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I={id:null,name:"",username:"",password:""},U=function(e){var t=Object(a.useState)([]),n=Object(u.a)(t,2),o=n[0],c=n[1];Object(a.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:t=e.sent,console.log("load data:"+JSON.stringify(t)),c(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var l=Object(a.useState)(I),m=Object(u.a)(l,2),d=m[0],p=m[1],b=Object(a.useState)("view"),g=Object(u.a)(b,2),E=g[0],h=g[1],y=function(e,t){c(o.map((function(n){return n.id===e?t:n})))};return r.a.createElement("div",{className:"flex-row"},r.a.createElement("div",{className:"flex-large"},"edit"===E?r.a.createElement(a.Fragment,null,r.a.createElement("h3",null,"Edit user"),r.a.createElement(f,{editing:!0,setViewMode:h,currentUser:d,updateUser:y})):"new"===E?r.a.createElement(a.Fragment,null,r.a.createElement("h3",null,"Register"),r.a.createElement(f,{editing:!1,setViewMode:h,currentUser:I,updateUser:y})):r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:"centered"},r.a.createElement("h3",null,"Users")),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}}),r.a.createElement(S,{users:o,editRow:function(e){h("edit"),p({id:e.id,name:e.name,username:e.username})},deleteUser:function(e){c(o.filter((function(t){return t.id!==e})))}}))))};function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var M=function(e){var t=e.currentBook,n=Object(a.useState)(t),o=Object(u.a)(n,2),c=o[0],l=o[1],d=Object(a.useState)([]),f=Object(u.a)(d,2),p=f[0],b=f[1];Object(a.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:t=e.sent,console.log("load book form user:"+JSON.stringify(t)),b(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var g=function(e){var t=e.target,n=t.name,a=t.value;l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},c,Object(m.a)({},n,a)))};return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.updateBook(c.id,c),e.setViewMode("viewBook")}},r.a.createElement("label",null,"Name"),r.a.createElement("input",{type:"text",name:"name",value:c.name,onChange:g}),r.a.createElement("label",null,"Owner Email"),r.a.createElement("select",{onChange:g,name:"ownerEmail"},p.map((function(e){return r.a.createElement("option",{value:e.username},e.username)}))),r.a.createElement("div",{className:"centered"},r.a.createElement("button",{className:"btn btn-primary"},"Save"),r.a.createElement("button",{onClick:function(){return e.setViewMode("viewBook")},className:"btn btn-danger"},"Cancel"))))},V=Object(p.a)({table:{minWidth:650}}),F=Object(b.a)((function(e){return{head:{backgroundColor:e.palette.common.black,color:e.palette.common.white},body:{fontSize:14}}}))(h.a),z=function(e){var t=V();return r.a.createElement(y.a,{component:w.a},r.a.createElement(g.a,{className:t.table,size:"small","aria-label":"a dense table"},r.a.createElement(v.a,null,r.a.createElement(O.a,null,r.a.createElement(F,null,"Book"),r.a.createElement(F,null))),r.a.createElement(E.a,null,e.books.length>0?e.books.map((function(t){return r.a.createElement(O.a,{key:t.id},r.a.createElement(h.a,{component:"th",scope:"row"},t.name),r.a.createElement(h.a,null,r.a.createElement("div",{style:e.isAdmin?{display:"flex",justifyContent:"flex-end"}:{display:"none"}},r.a.createElement("button",{onClick:function(){e.editRow(t)},className:"btn btn-primary"},"Edit"),r.a.createElement("button",{onClick:function(){return e.deleteBook(t.id)},className:"btn btn-danger"},"Delete")),r.a.createElement("div",{style:e.isLoggedIn&&!e.isAdmin?{display:"flex",justifyContent:"flex-end"}:{display:"none"}},r.a.createElement("a",{href:"mailto:".concat(t.ownerEmail,"\n                            ?subject=Book Library Borrow Request - ").concat(t.name,"\n                            &body=Dear Sir/Madam,").concat(escape("\r\n")," I'm interested in borrowing ").concat(t.name,".").concat(escape("\r\n"),"Could you send me more information please?"),className:"btn btn-primary"},"Borrow"))))})):r.a.createElement(O.a,{colSpan:3},r.a.createElement(h.a,null,"No books")))))},R=Object(a.createContext)({}),W=function(){return Object(a.useContext)(R)},_=function(){sessionStorage.isSessionLoggedIn=!1,P.auth().signOut().then((function(){})).catch((function(e){console.log("Error with Firebase : "+e),alert(e)}))},H=function(e){var t=e.children,n=Object(a.useState)({loading:!0,data:null,isAdmin:!1,isLoggedIn:!1,isSessionLoggedIn:!1}),o=Object(u.a)(n,2),c=o[0],l=o[1],i=function(e){console.log("setAuthData:"+JSON.stringify(e)),sessionStorage.isSessionLoggedIn,sessionStorage.isSessionLoggedIn=!0,console.log("set Session:"+sessionStorage.isSessionLoggedIn),l({data:e,isAdmin:e&&"admin@booklibrary.com"===e.email,isLoggedIn:null!==e,isSessionLoggedin:sessionStorage.isSessionLoggedIn===String(!0)})};return Object(a.useEffect)((function(){var e=P.auth().onAuthStateChanged((function(e){i(e||null)}));return function(){return e()}}),[]),r.a.createElement(R.Provider,{value:{auth:c,setAuthData:i}},t)},q=function(e){var t=W().auth;console.log("admin:"+JSON.stringify(t)),console.log("book:"+JSON.stringify(e));var n=Object(a.useState)([]),o=Object(u.a)(n,2),c=o[0],l=o[1];Object(a.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:t=e.sent,console.log("load data:"+JSON.stringify(t)),l(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),console.log("loaded books:"+JSON.stringify(c));console.log("set books:"+JSON.stringify(c));var m=Object(a.useState)({id:null,name:"",ownerEmail:""}),d=Object(u.a)(m,2),f=d[0],p=d[1],b=Object(a.useState)("view"),g=Object(u.a)(b,2),E=g[0],h=g[1],y=function(e,t){C(t),l(c.map((function(n){return n.id===e?t:n}))),console.log("update book"+JSON.stringify(c))};return r.a.createElement("div",{className:"container flex-row"},r.a.createElement("div",{className:"flex-large"},"edit"===E?r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:"centered"},r.a.createElement("h3",null,"Edit Book")),r.a.createElement(M,{editing:!0,setViewMode:h,currentBook:f,updateBook:y})):"new"===E?r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:"centered"},r.a.createElement("h3",null,"Create Book")),r.a.createElement(M,{editing:!1,setViewMode:h,currentBook:f,updateBook:y})):r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:"centered"},r.a.createElement("h3",null,"Books")),r.a.createElement("div",{style:t.isAdmin?{display:"flex",justifyContent:"flex-end",margin:"10px"}:{display:"none"}},r.a.createElement("button",{onClick:function(){h("new")},className:"btn btn-primary"},"Add New Book")),r.a.createElement(z,{books:c,editRow:function(e){h("edit"),p({id:e.id,name:e.name,ownerEmail:e.ownerEmail})},deleteBook:function(e){D(e),l(c.filter((function(t){return t.id!==e})))},isAdmin:t.isAdmin,isLoggedIn:t.isLoggedIn}))))},K=n(20),Y=function(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),o=n[0],c=n[1],l=Object(a.useState)(""),i=Object(u.a)(l,2),s=i[0],m=i[1];return r.a.createElement("div",{className:"container col-lg-3 center-block"},r.a.createElement("h3",null,"Login In"),r.a.createElement("form",{autoComplete:"off",onSubmit:function(t){t.preventDefault(),console.log("history:"+JSON.stringify(e)),B(o,s).then((function(t){if(console.log("login successful!"+t),!t)throw new Error;var n=e.location.state?e.location.state.from.pathname:"";console.log("redirect to :"+JSON.stringify(n)),e.history.push(n)})).catch((function(e){console.error("login unsuccessful!"+e),alert("wrong email or password combination")}))}},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter email",value:o,onChange:function(e){c(e.target.value)}})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control",id:"exampleInputPassword1",placeholder:"Password",value:s,onChange:function(e){m(e.target.value)}})),r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit"),r.a.createElement(K.b,{to:"/register",className:"btn btn-link"},"Register")))},Q=n(5),T=n(25),Z=function(e){var t=e.component,n=Object(Q.a)(e,["component"]),a=W().auth;return console.log("Private Route, Logged User:"+JSON.stringify(a.isSessionLoggedin)),a.loading?r.a.createElement(T.b,Object.assign({},n,{render:function(){return r.a.createElement("p",null,"Loading...")}})):r.a.createElement(T.b,Object.assign({},n,{render:function(e){return a.isSessionLoggedin?r.a.createElement(t,e):r.a.createElement(T.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},G=function(e){return r.a.createElement("div",null,r.a.createElement("h3",null,"Register"),r.a.createElement(f,{editing:!0,setViewMode:U.setViewMode,currentUser:I,updateUser:function(t,n){console.log("new user:"+JSON.stringify(n)),function(e,t){var n=P.firestore();P.auth().createUserWithEmailAndPassword(e,t).then((function(){n.collection("Library_Users").add({username:e})})).then((function(){console.log("created user.")})).catch((function(e){console.error("Error creating user: ",e),alert(e)}))}(n.username,n.password),function(e){var t=e.match.path;console.log("current href :"+t);var n={pathname:"/login",state:{from:{pathname:t}}};e.history.push(n)}(e)}}))},X=n(116),$=n(115),ee=function(e){var t=W().auth.data;console.log("Nav Bar User:"+JSON.stringify(t));var n=W().auth.isAdmin,a=t?t.email:"";return r.a.createElement(X.a,{bg:"primary",variant:"dark"},r.a.createElement($.a,{className:"mr-auto"},r.a.createElement(K.b,{to:"/",class:"nav-link"},"Home"),n?r.a.createElement(K.b,{to:"/users",class:"nav-link"},"Users"):"",r.a.createElement(K.b,{to:"/books",class:"nav-link"},"Books")),r.a.createElement(X.a.Collapse,{className:"justify-content-end"},""!==a?r.a.createElement("div",null,r.a.createElement(X.a.Text,null,"Signed in as : ",r.a.createElement("a",{href:"#login"},a)),r.a.createElement("button",{onClick:function(){_()},className:"bg-light btn my-2 my-sm-0",style:{marginLeft:"10px"}},"Signout")):r.a.createElement("a",{href:"/Login",className:"bg-light btn my-2 my-sm-0"},"Login")))},te=function(){return r.a.createElement("div",{className:"container"},r.a.createElement("h2",null,"Home page"),r.a.createElement("blockquote",null,"Welcome to the Book Library!"))},ne=function(e){var t=W().authUser;return console.log("Rendering App..."),console.log("App Props:"+JSON.stringify(e)),console.log("App auth User:"+JSON.stringify(t)),r.a.createElement(H,null,r.a.createElement(K.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(ee,null)),r.a.createElement("br",null),r.a.createElement(T.b,{path:"/",exact:!0,component:te}),r.a.createElement(T.b,{path:"/login",exact:!0,component:Y}),r.a.createElement(Z,{path:"/users",component:U}),r.a.createElement(T.b,{path:"/books",render:function(e){return r.a.createElement(q,e)}}),r.a.createElement(T.b,{path:"/register",exact:!0,component:G})))},ae=document.getElementById("root");c.a.render(r.a.createElement(ne,null),ae)}},[[65,1,2]]]);
//# sourceMappingURL=main.5ba48dd2.chunk.js.map